ioctl() return values are negative if an error occurs. A positive
value can be returned legitimately.

This patch is required for jscal to work with kernels starting with
2.6.32; the axis and button map ioctls return the size of the buffer
used when everything goes well.

--- joystick-20051019.orig/utils/jscal.c
+++ joystick-20051019/utils/jscal.c
@@ -181,15 +181,15 @@
 {
 	int i,j;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGBUTTONS, &buttons)) {
+	if (ioctl(fd, JSIOCGBUTTONS, &buttons) < 0) {
 		perror("jscal: error getting buttons");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGCORR, &corr)) {
+	if (ioctl(fd, JSIOCGCORR, &corr) < 0) {
 		perror("jscal: error getting correction");
 		exit(1);
 	}
@@ -220,7 +220,7 @@
 		corr[i].prec = 0;
 	}
 
-	if (ioctl(fd, JSIOCSCORR, &corr)) {
+	if (ioctl(fd, JSIOCSCORR, &corr) < 0) {
 		perror("jscal: error setting correction");
 		exit(1);
 	}
@@ -326,7 +326,7 @@
 
 	putchar('\n');
 
-	if (ioctl(fd, JSIOCSCORR, &corr)) {
+	if (ioctl(fd, JSIOCSCORR, &corr) < 0) {
 		perror("jscal: error setting correction");
 		exit(1);
 	}
@@ -344,11 +344,11 @@
 {
 	int i;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGBUTTONS, &buttons)) {
+	if (ioctl(fd, JSIOCGBUTTONS, &buttons) < 0) {
 		perror("jscal: error getting buttons");
 		exit(1);
 	}
@@ -402,7 +402,7 @@
 	        ax[i]=axmes[(axmap[i])];
 	}
 	//Read again current callibration settings
-	if (ioctl(fd, JSIOCGCORR, &corr)) {
+	if (ioctl(fd, JSIOCGCORR, &corr) < 0) {
 		perror("jscal: error getting correction");
 		exit(1);
 	}
@@ -410,7 +410,7 @@
 	for (i = 0; i < axes; i++) {
 	        corr_tmp[i]=corr[(ax[i])];
 	}
-	if (ioctl(fd, JSIOCSCORR, &corr_tmp)) {
+	if (ioctl(fd, JSIOCSCORR, &corr_tmp) < 0) {
 		perror("jscal: error setting correction");
 		exit(1);
 	}
@@ -421,15 +421,15 @@
 {
 	int i,j;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGBUTTONS, &buttons)) {
+	if (ioctl(fd, JSIOCGBUTTONS, &buttons) < 0) {
 		perror("jscal: error getting buttons");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGCORR, &corr)) {
+	if (ioctl(fd, JSIOCGCORR, &corr) < 0) {
 		perror("jscal: error getting correction");
 		exit(1);
 	}
@@ -453,11 +453,11 @@
   int axis_mapping = 0;
   int btn_mapping = 0;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
-	if (ioctl(fd, JSIOCGBUTTONS, &buttons)) {
+	if (ioctl(fd, JSIOCGBUTTONS, &buttons) < 0) {
 		perror("jscal: error getting buttons");
 		exit(1);
 	}
@@ -559,7 +559,7 @@
 	int i,j;
 	int t = 0;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
@@ -620,7 +620,7 @@
 		exit(1);
 	}
 	
-	if (ioctl(fd, JSIOCSCORR, &corr)) {
+	if (ioctl(fd, JSIOCSCORR, &corr) < 0) {
 		perror("jscal: error setting correction");
 		exit(1);
 	}
@@ -631,12 +631,12 @@
 	int i;
 	struct js_event ev;
 
-	if (ioctl(fd, JSIOCGAXES, &axes)) {
+	if (ioctl(fd, JSIOCGAXES, &axes) < 0) {
 		perror("jscal: error getting axes");
 		exit(1);
 	}
 
-	if (ioctl(fd, JSIOCGBUTTONS, &buttons)) {
+	if (ioctl(fd, JSIOCGBUTTONS, &buttons) < 0) {
 		perror("jscal: error getting buttons");
 		exit(1);
 	}
@@ -737,7 +737,7 @@
 		exit(1);
 	}
 
-	if (ioctl(fd, JSIOCGVERSION, &version)) {
+	if (ioctl(fd, JSIOCGVERSION, &version) < 0) {
 		perror("jscal: error getting version");
 		exit(1);
 	}
